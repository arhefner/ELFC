; -------------------------------------------------------------------
; This file generated by ElfC, based on SubC
; SubC Copyright 2012-2025 by Nils Holm
; -------------------------------------------------------------------
#include include/ops_c.inc
#include include/bios.inc
#include include/kernel.inc
#include include/elfc.inc

	           proc scanfmt

            extrn C_init

            extrn C_fdinit

            extrn C_fdtable

            extrn C_fildes

            extrn Cabort

            extrn Cabs

            extrn Catexit      

            extrn Cexit            

            extrn Cmalloc

            extrn Ccalloc 

            extrn Crealloc

            extrn Cfree  

            extrn Catoi 

            extrn Citoa           

            extrn Citox

            extrn Citou           

            extrn Cdiv 

            extrn Cbsearch              

            extrn Cqsort

            extrn Crand

            extrn Csrand

            extrn Ccreat

            extrn Copen

            extrn Cclose

            extrn Cread

            extrn Cwrite

            extrn Clseek

            extrn Cunlink

            extrn Crename

            extrn Cmin

            extrn Cmax

            extrn Cstdin

            extrn Cstdout

            extrn Cstderr

            extrn Cputs

            extrn Cputstr

            extrn Cgets

            extrn Cputch

            extrn Cgetch

            extrn Cputchar

            extrn Cgetchar

            extrn Cfdopen

            extrn Cfclose

            extrn Cfopen

            extrn Cferror

            extrn Cfeof

            extrn Cclearerr

            extrn Cfgetc

            extrn Cfputc

            extrn Cfgets

            extrn Cfputs

            extrn Cungetc

            extrn Cfread

            extrn Cfwrite

            extrn Cfflush

            extrn Cfprintf

            extrn Ckprintf

            extrn Cprintf

            extrn Csprintf

            extrn Cvfprintf

            extrn Cvprintf

            extrn Cvsprintf

            extrn Cfscanf

            extrn Cscanf

            extrn Csscanf

            extrn Cfgetpos

            extrn Cfsetpos

            extrn Cfseek

            extrn Cftell

            extrn Cperror

            extrn Crewind

            extrn Cremove

            extrn Ctmpnam

            extrn Ctmpfile

            extrn Cfileno
	;----- cgpublic
	              public Cfname
Cfname:    ds 20    ;----- cggbss
	;----- cgpublic
	              public Ci
Ci:	db	$00, $00  ;----- cgdefw LSB first, MSB second
	;----- cgpublic
	              public Cch
Cch:	db	$00    ;----- cgdefb
	;----- cgpublic
	              public Cmain
Cmain:
  ;----- cgsetup
#ifdef STGROM
      load   r1, $F000  ; set up handler for STG Breakpoint
#endif
	;---- cgentry
	          sex   r2   				 ; make sure X = SP
	          push  rb				 		 ; save current BP (base pointer)
	          copy  r7, rb			 	 ; set BP to current ES location
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  -4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;----- begin stmt ------
	;----- cgldga
	 				call epush16
	 				  dw Cfname
	;----- cgstorlw
	          call  lstor16      ; store value from ES in local variable
	          dw  -4  ;--- offset
	;----- cgpopd
	          call  dpop16   		 ; get result from expression stack
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L3
	;----- cgjump
	 				  lbr	L3

L2:
  db 'Enter an integer number (between %d and %d): '    ;----- cgdefs
	db	$00    ;----- cgdefb

L3:
	;----- cglit
	 				call epush16
	 				  dw 32767
	;----- cglit
	 				call epush16
	 				  dw -32767
	;----- cgldlab
	 				call epush16
	 				  dw  L2
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  6  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L5
	;----- cgjump
	 				  lbr	L5

L4:
  db '%d'    ;----- cgdefs
	db	$00    ;----- cgdefb

L5:
	;----- cgldga
	 				call epush16
	 				  dw Ci
	;----- cgldlab
	 				call epush16
	 				  dw  L4
	;----- cgcall
	          call  Cscanf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L7
	;----- cgjump
	 				  lbr	L7

L6:
  db 10, 'You entered %i', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L7:
	;----- cgldgw
	 				call vpush16
	 				  dw Ci
	;----- cgldlab
	 				call epush16
	 				  dw  L6
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L9
	;----- cgjump
	 				  lbr	L9

L8:
  db 'What is your first name?', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L9:
	;----- cgldlab
	 				call epush16
	 				  dw  L8
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  2  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L11
	;----- cgjump
	 				  lbr	L11

L10:
  db '%19s'    ;----- cgdefs
	db	$00    ;----- cgdefb

L11:
	;----- cgldga
	 				call epush16
	 				  dw Cfname
	;----- cgldlab
	 				call epush16
	 				  dw  L10
	;----- cgcall
	          call  Cscanf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L13
	;----- cgjump
	 				  lbr	L13

L12:
  db 10, 'Hello, %s!', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L13:
	;----- cgldga
	 				call epush16
	 				  dw Cfname
	;----- cgldlab
	 				call epush16
	 				  dw  L12
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L15
	;----- cgjump
	 				  lbr	L15

L14:
  db 'Enter a hexadecimal number:', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L15:
	;----- cgldlab
	 				call epush16
	 				  dw  L14
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  2  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L17
	;----- cgjump
	 				  lbr	L17

L16:
  db '%x'    ;----- cgdefs
	db	$00    ;----- cgdefb

L17:
	;----- cgldga
	 				call epush16
	 				  dw Ci
	;----- cgldlab
	 				call epush16
	 				  dw  L16
	;----- cgcall
	          call  Cscanf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L19
	;----- cgjump
	 				  lbr	L19

L18:
  db 10, 'You entererd %#x', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L19:
	;----- cgldgw
	 				call vpush16
	 				  dw Ci
	;----- cgldlab
	 				call epush16
	 				  dw  L18
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L21
	;----- cgjump
	 				  lbr	L21

L20:
  db 'Enter an octal number:', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L21:
	;----- cgldlab
	 				call epush16
	 				  dw  L20
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  2  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L23
	;----- cgjump
	 				  lbr	L23

L22:
  db '%o'    ;----- cgdefs
	db	$00    ;----- cgdefb

L23:
	;----- cgldga
	 				call epush16
	 				  dw Ci
	;----- cgldlab
	 				call epush16
	 				  dw  L22
	;----- cgcall
	          call  Cscanf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L25
	;----- cgjump
	 				  lbr	L25

L24:
  db 10, 'You entererd %#o', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L25:
	;----- cgldgw
	 				call vpush16
	 				  dw Ci
	;----- cgldlab
	 				call epush16
	 				  dw  L24
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L27
	;----- cgjump
	 				  lbr	L27

L26:
  db 'Enter a non-space character:', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L27:
	;----- cgldlab
	 				call epush16
	 				  dw  L26
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  2  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L29
	;----- cgjump
	 				  lbr	L29

L28:
  db ' %c'    ;----- cgdefs
	db	$00    ;----- cgdefb

L29:
	;----- cgldga
	 				call epush16
	 				  dw Cch
	;----- cgldlab
	 				call epush16
	 				  dw  L28
	;----- cgcall
	          call  Cscanf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L31
	;----- cgjump
	 				  lbr	L31

L30:
  db 10, 'You entererd ', 39, '%c', 39, ' (%d)', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L31:
	;----- cgldgb
	 				call vpush8
	 				  dw Cch
	;----- cgldgb
	 				call vpush8
	 				  dw Cch
	;----- cgldlab
	 				call epush16
	 				  dw  L30
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  6  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L33
	;----- cgjump
	 				  lbr	L33

L32:
  db 'Enter any five characters:', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L33:
	;----- cgldlab
	 				call epush16
	 				  dw  L32
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  2  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L35
	;----- cgjump
	 				  lbr	L35

L34:
  db '%5c'    ;----- cgdefs
	db	$00    ;----- cgdefb

L35:
	;----- cgldlw
	          call  lpush16       ; push value of local variable on ES
	          dw  -4  ;--- offset
	;----- cgldlab
	 				call epush16
	 				  dw  L34
	;----- cgcall
	          call  Cscanf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;----- cgldga
	 				call epush16
	 				  dw Cfname
	;----- cglit
	 				call epush16
	 				  dw 5
	;----- cgadd
	          call  add16				 ; add TOS and SOS on Expression Stack

	;----- cglit
	 				call epush16
	 				  dw 0
	;----- cgpopptr
	          call  swap16				 ; swap TOS and SOS on Expression Stack
	          call  dpop16   		 ; get pointer from expression stack
	;----- cgstorib
	          call  pstor8       ; store value from ES in pointer variable
	;----- cgpopd
	          call  dpop16   		 ; get result from expression stack
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L37
	;----- cgjump
	 				  lbr	L37

L36:
  db 10, 'You entered %s', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L37:
	;----- cgldlw
	          call  lpush16       ; push value of local variable on ES
	          dw  -4  ;--- offset
	;----- cgldlab
	 				call epush16
	 				  dw  L36
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L39
	;----- cgjump
	 				  lbr	L39

L38:
  db 10, 'Scanset: numbers only:', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L39:
	;----- cgldlab
	 				call epush16
	 				  dw  L38
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  2  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L41
	;----- cgjump
	 				  lbr	L41

L40:
  db ' %19[0-9]'    ;----- cgdefs
	db	$00    ;----- cgdefb

L41:
	;----- cgldlw
	          call  lpush16       ; push value of local variable on ES
	          dw  -4  ;--- offset
	;----- cgldlab
	 				call epush16
	 				  dw  L40
	;----- cgcall
	          call  Cscanf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L43
	;----- cgjump
	 				  lbr	L43

L42:
  db 10, 'You entered %s', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L43:
	;----- cgldlw
	          call  lpush16       ; push value of local variable on ES
	          dw  -4  ;--- offset
	;----- cgldlab
	 				call epush16
	 				  dw  L42
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L45
	;----- cgjump
	 				  lbr	L45

L44:
  db 10, '^Scanset: no capital letters:', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L45:
	;----- cgldlab
	 				call epush16
	 				  dw  L44
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  2  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L47
	;----- cgjump
	 				  lbr	L47

L46:
  db ' %19[^A-Z]'    ;----- cgdefs
	db	$00    ;----- cgdefb

L47:
	;----- cgldlw
	          call  lpush16       ; push value of local variable on ES
	          dw  -4  ;--- offset
	;----- cgldlab
	 				call epush16
	 				  dw  L46
	;----- cgcall
	          call  Cscanf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------
	;----- begin stmt ------
	;---- queue lbr L49
	;----- cgjump
	 				  lbr	L49

L48:
  db 10, 'You entered %s', 10    ;----- cgdefs
	db	$00    ;----- cgdefb

L49:
	;----- cgldlw
	          call  lpush16       ; push value of local variable on ES
	          dw  -4  ;--- offset
	;----- cgldlab
	 				call epush16
	 				  dw  L48
	;----- cgcall
	          call  Cprintf
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;---- queue dpush
	;----- push + pop data not required, data remains unchanged in RA
	;----- end stmt ------

L1:
	;----- cgstack
	          call  esmove				 ; move pointer for Expression Stack
	          dw  4  ;--- offset
	          lbdf  auto_err			 ; exit immediately when stack is exhausted by auto variables
	;----- cgexit
	          sex   r2            ; make sure X = SP
	          call  escheck       ; check for expression stack creep
	          pop   rb				 		 ; restore BP (base pointer)

	          rtn	  			 	     ; return to caller
	;---- cgpostlude
	             endp
